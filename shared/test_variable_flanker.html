<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>N-back task</title>
        <!-- <script src="../shared/languages.js"></script>
        <script src="../shared/parameters.js"></script>
        <script src="../shared/normsinverz.js"></script>
        <script src="../shared/statCalculation.js"></script> -->
        <script src="../static/js/jspsych-6.1.0/jspsych.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
        <script src="../static/js/jspsych-6.1.0/plugins/jspsych-instructions.js"></script>
        <script src="../shared/stimuli.js"></script>
        <script src="../shared/createBlocks.js"></script>
        <!-- <script src="../shared/flanker_parameters.js"></script> -->
        <!-- <script src="../shared/stimuli_flanker.js"></script> -->
        <!-- <script src="../shared/createFlankerBlock.js"></script> -->
        <link href="../static/js/jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"/>
        <link href="../static/css/style.css" rel="stylesheet" type="text/css"/>
    </head>
    <body></body>
    <script>


/* parameters_flanker.js */
const practice_duration = 30000; // duration of practice
const main_duration = 90000; // duration of main task
let total_flanker = 0;
let block_trial_count = 0;
let practice_indicator = 1; // Indicator of whether the trials being shown belong to the practice phase A !! Practice déjà défini dans experiment
let timeout = 0; // Indicator whether trial was responded to when the task timed out
let block_start;
let block_time_limit;
let items_flanker = Array.from(Array(16).keys()); // Array from 0-15


/* stimuli_flanker.js */

const ar = "../static/images/ar.PNG";
const al = "../static/images/al.PNG";
const mr_fl = "../static/images/mr_fl.PNG";
const ml_fr = "../static/images/ml_fr.PNG";

// Create object that has all the possible stimuli for the task (stimuli_flanker)
var stimuli_flanker = [
	{stim: al, stimsign: "<<<<<", resp1: ar, resp1sign: ">>>>>", resp2: al, resp2sign: "<<<<<", correct_response: 1, condition: 1, item: 0},
	{stim: al, stimsign: "<<<<<", resp1: al, resp1sign: "<<<<<", resp2: ar, resp2sign: ">>>>>", correct_response: 0, condition: 1, item: 1},
	{stim: ar, stimsign: ">>>>>", resp1: ar, resp1sign: ">>>>>", resp2: al, resp2sign: "<<<<<", correct_response: 0, condition: 1, item: 2},
	{stim: ar, stimsign: ">>>>>", resp1: al, resp1sign: "<<<<<", resp2: ar, resp2sign: ">>>>>", correct_response: 1, condition: 1, item: 3},
	{stim: al, stimsign: "<<<<<", resp1: ml_fr, resp1sign: ">><>>", resp2: mr_fl, resp2sign: "<<><<", correct_response: 0, condition: 2, item: 4},
	{stim: al, stimsign: "<<<<<", resp1: mr_fl, resp1sign: "<<><<", resp2: ml_fr, resp2sign: ">><>>", correct_response: 1, condition: 2, item: 5},
	{stim: ar, stimsign: ">>>>>", resp1: ml_fr, resp1sign: ">><>>", resp2: mr_fl, resp2sign: "<<><<", correct_response: 1, condition: 2, item: 6},
	{stim: ar, stimsign: ">>>>>", resp1: mr_fl, resp1sign: "<<><<", resp2: ml_fr, resp2sign: ">><>>", correct_response: 0, condition: 2, item: 7},
	{stim: mr_fl, stimsign: "<<><<", resp1: al, resp1sign: "<<<<<", resp2: ar, resp2sign: ">>>>>", correct_response: 0, condition: 3, item: 8},
	{stim: mr_fl, stimsign: "<<><<", resp1: ar, resp1sign: ">>>>>", resp2: al, resp2sign: "<<<<<", correct_response: 1, condition: 3, item: 9},
	{stim: ml_fr, stimsign: ">><>>", resp1: al, resp1sign: "<<<<<", resp2: ar, resp2sign: ">>>>>", correct_response: 1, condition: 3, item: 10},
	{stim: ml_fr, stimsign: ">><>>", resp1: ar, resp1sign: ">>>>>", resp2: al, resp2sign: "<<<<<", correct_response: 0, condition: 3, item: 11},
	{stim: mr_fl, stimsign: "<<><<", resp1: mr_fl, resp1sign: "<<><<", resp2: ml_fr, resp2sign: ">><>>", correct_response: 1, condition: 4, item: 12},
	{stim: mr_fl, stimsign: "<<><<", resp1: ml_fr, resp1sign: ">><>>", resp2: mr_fl, resp2sign: "<<><<", correct_response: 0, condition: 4, item: 13},
	{stim: ml_fr, stimsign: ">><>>", resp1: mr_fl, resp1sign: "<<><<", resp2: ml_fr, resp2sign: ">><>>", correct_response: 0, condition: 4, item: 14},
	{stim: ml_fr, stimsign: ">><>>", resp1: ml_fr, resp1sign: ">><>>", resp2: mr_fl, resp2sign: "<<><<", correct_response: 1, condition: 4, item: 15}
];
/* create the (nested) timeline variables */
const practice_array = generateFlankerVariables(100)
console.log(practice_array)

/* functions_flanker.js */


function display_flanker(stimulus) {
  return `<img src='${stimulus}' width='290'><p><br></p>`;
}


function generateFlankerVariables(totalLength = 100) {
    const shuffledBase = [...stimuli_flanker].sort(() => Math.random() - 0.5);
  
    let repeated = [];
    while (repeated.length < totalLength) {
      repeated.push(...shuffledBase);
    }
    repeated.length = totalLength;
  
    return repeated.sort(() => Math.random() - 0.5);
  }



/* define the trials */


var welcome = {
    type: "html-keyboard-response",
    stimulus: "<div style='text-align: center;'><p>Welcome to the experiment.</p><img src='" + ar + "' alt='ar image'><p>Press any key to begin.</p></div>",
  };

var test_display = {
    type: "html-keyboard-response",
    stimulus: function() {
    return display_flanker(jsPsych.timelineVariable('stim', true))
    //"<img src='" + jsPsych.timelineVariable('resp1', true) + "' alt='ar image'>"
    }
    

        // return `<img src='${jsPsych.timelineVariable('stim')}' width='290'><p><br></p>`;}
        // return `<img src='${stimuli_flanker[1].stim}' width='290'><p><br></p>`;}
        // return `<img src='${practice_array[1].stim}' width='290'><p><br></p>`;}
        // return display_flanker(practice_array[1]); }
        // return display_flanker("../static/images/ar.PNG"); }
        // return display_flanker(jsPsych.timelineVariable); }
  }



/* create trial of flanker : not needed here */
// const test_flanker = createFlankerBlock()

/* create (nested) timeline */

const flanker_nested_timeline = { //timeline flanker
    timeline: [test_display],
    timeline_variables: practice_array,
    // [ //practice_array
    //     {stim: al, stimsign: "<<<<<", resp1: ar, resp1sign: ">>>>>", resp2: al, resp2sign: "<<<<<", correct_response: 1, condition: 1, item: 0},
	//     {stim: al, stimsign: "<<<<<", resp1: al, resp1sign: "<<<<<", resp2: ar, resp2sign: ">>>>>", correct_response: 0, condition: 1, item: 1}
    // ], 

    //   conditional_function: function () {
    //       return nbackCounter > 0 && nbackCounter % 10 === 0
    //   }
  }

/* initiatialize jsPsych with the main timeline */ 
jsPsych.init({
  timeline: [welcome, flanker_nested_timeline], //flanker_nested_timeline],
  on_finish: function() {
    jsPsych.data.displayData();
  }
});

// Note : I will need to append the var that assign practice indicator to 1 or 0, before flanker_nested_timeline.
// console.log(stimuli_flanker[1]);
// console.log(practice_array);
// console.log(practice_array[1]);
// console.log(practice_array[1].stim);

</script>
</html>